# Phase 1 Plan: Command/Workflow Fixes

**Phase:** 01-contracts-first-governance-core  
**Plan:** 01-02  
**Created:** 2026-02-03  
**Status:** Ready for execution

## Overview

This plan addresses **Part A2 and A3** from `01-CONTEXT.md`:
- Add OpenCode-compatible frontmatter to 8 command files
- Create 3 missing commands/workflows to complete the chain

## Task Breakdown

<task id="A2-T1" priority="P1">
### Add Frontmatter to new-project.md

**File:** `template/commands/idumb/new-project.md`  
**Action:** Prepend frontmatter block

```yaml
---
description: "Initialize a new iDumb-governed project with full governance structure"
agent: idumb-supreme-coordinator
---
```

**Acceptance Criteria:**
- [ ] YAML frontmatter is first content in file
- [ ] Description matches file's primary purpose
- [ ] Agent is `idumb-supreme-coordinator`
</task>

<task id="A2-T2" priority="P1">
### Add Frontmatter to research.md

**File:** `template/commands/idumb/research.md`  
**Action:** Prepend frontmatter block

```yaml
---
description: "Execute comprehensive research phase using parallel agent mode"
agent: idumb-supreme-coordinator
---
```

**Acceptance Criteria:**
- [ ] YAML frontmatter is first content in file
- [ ] Description matches file's primary purpose
- [ ] Agent is `idumb-supreme-coordinator`
</task>

<task id="A2-T3" priority="P1">
### Add Frontmatter to roadmap.md

**File:** `template/commands/idumb/roadmap.md`  
**Action:** Prepend frontmatter block

```yaml
---
description: "Create or update project roadmap based on research and requirements"
agent: idumb-supreme-coordinator
---
```

**Acceptance Criteria:**
- [ ] YAML frontmatter is first content in file
- [ ] Description matches file's primary purpose
- [ ] Agent is `idumb-supreme-coordinator`
</task>

<task id="A2-T4" priority="P1">
### Add Frontmatter to discuss-phase.md

**File:** `template/commands/idumb/discuss-phase.md`  
**Action:** Prepend frontmatter block

```yaml
---
description: "Interactive discussion about phase implementation approach"
agent: idumb-supreme-coordinator
---
```

**Acceptance Criteria:**
- [ ] YAML frontmatter is first content in file
- [ ] Description matches file's primary purpose
- [ ] Agent is `idumb-supreme-coordinator`
</task>

<task id="A2-T5" priority="P1">
### Add Frontmatter to plan-phase.md

**File:** `template/commands/idumb/plan-phase.md`  
**Action:** Prepend frontmatter block

```yaml
---
description: "Create detailed implementation plan for a specific phase"
agent: idumb-supreme-coordinator
---
```

**Acceptance Criteria:**
- [ ] YAML frontmatter is first content in file
- [ ] Description matches file's primary purpose
- [ ] Agent is `idumb-supreme-coordinator`
</task>

<task id="A2-T6" priority="P1">
### Add Frontmatter to execute-phase.md

**File:** `template/commands/idumb/execute-phase.md`  
**Action:** Prepend frontmatter block

```yaml
---
description: "Execute a phase plan with full governance and monitoring"
agent: idumb-supreme-coordinator
---
```

**Acceptance Criteria:**
- [ ] YAML frontmatter is first content in file
- [ ] Description matches file's primary purpose
- [ ] Agent is `idumb-supreme-coordinator`
</task>

<task id="A2-T7" priority="P1">
### Add Frontmatter to verify-work.md

**File:** `template/commands/idumb/verify-work.md`  
**Action:** Prepend frontmatter block

```yaml
---
description: "Verify completion of work against acceptance criteria"
agent: idumb-supreme-coordinator
---
```

**Acceptance Criteria:**
- [ ] YAML frontmatter is first content in file
- [ ] Description matches file's primary purpose
- [ ] Agent is `idumb-supreme-coordinator`
</task>

<task id="A2-T8" priority="P1">
### Add Frontmatter to debug.md

**File:** `template/commands/idumb/debug.md`  
**Action:** Prepend frontmatter block

```yaml
---
description: "Diagnose and resolve issues in the project or workflow"
agent: idumb-supreme-coordinator
---
```

**Acceptance Criteria:**
- [ ] YAML frontmatter is first content in file
- [ ] Description matches file's primary purpose
- [ ] Agent is `idumb-supreme-coordinator`
</task>

---

<task id="A3-T1" priority="P1">
### Create /idumb:resume Command

**File:** `template/commands/idumb/resume.md` (NEW)  
**Action:** Create command file referencing existing workflow

**Content:**
```markdown
---
description: "Resume work from last session with context restoration"
agent: idumb-supreme-coordinator
---

# /idumb:resume

Resume work from last session with automatic context restoration.

## Usage

```
/idumb:resume [--force-refresh] [--skip-validation]
```

## Description

Restores project context after session break:
- Loads state from `.idumb/brain/state.json`
- Validates context freshness (warns if >48h stale)
- Detects where work left off
- Routes to appropriate workflow

## Workflow Reference

See: `workflows/resume-project.md`

## Arguments

| Argument | Description | Default |
|----------|-------------|---------|
| `--force-refresh` | Reload all context | `false` |
| `--skip-validation` | Skip freshness check | `false` |

## Exit Behavior

Routes to one of:
- `/idumb:execute-phase` (if plan exists, execution incomplete)
- `/idumb:verify-work` (if execution complete, unverified)
- `/idumb:plan-phase` (if context exists, no plan)
- `/idumb:discuss-phase` (if roadmap exists, no context)
- `/idumb:roadmap` (if project exists, no roadmap)

## Governance

**Delegation Chain:**
```
user → supreme-coordinator → high-governance
  └─→ low-validator (state checks)
```

## Metadata

```yaml
category: session
priority: P0
complexity: low
version: 0.1.0
```
```

**Acceptance Criteria:**
- [ ] File created at correct path
- [ ] Frontmatter includes description and agent
- [ ] References existing workflow
</task>

<task id="A3-T2" priority="P1">
### Create research.md Workflow

**File:** `template/workflows/research.md` (NEW)  
**Action:** Create workflow file matching command structure

**Content:**
```markdown
---
name: research
description: "Orchestrates parallel research agents to gather comprehensive project intelligence"
type: workflow
version: 0.1.0
last_updated: 2026-02-03
---

# Research Workflow

Orchestrates parallel research agents to gather comprehensive intelligence for project planning.

## Entry Conditions

```yaml
entry_conditions:
  must_have:
    - exists: ".idumb/brain/state.json"
    - state: "initialized = true"
  should_have:
    - exists: ".planning/PROJECT.md"
  blocked_when:
    - condition: "!exists('.idumb/brain/state.json')"
      redirect: "/idumb:init"
      message: "iDumb not initialized"
```

## Workflow Steps

```yaml
workflow:
  name: research
  interactive: false  # Agent-driven
  
  steps:
    1_validate_context:
      action: "Check project initialization"
      tool: idumb-validate:structure
      
    2_determine_scope:
      action: "Analyze research request"
      extract:
        - topic_domain
        - depth_requirement
        - focus_areas
        
    3_spawn_researchers:
      action: "Delegate to parallel research agents"
      parallel: true
      agents:
        - idumb-project-researcher (tech)
        - idumb-project-researcher (market)
        - idumb-project-researcher (user)
        - idumb-project-researcher (competitor)
      timeout: 300s
      
    4_collect_findings:
      action: "Gather research outputs"
      wait_for: all_agents
      
    5_synthesize:
      action: "Delegate to research synthesizer"
      agent: idumb-research-synthesizer
      inputs: all_research_outputs
      
    6_validate_synthesis:
      action: "Check synthesis completeness"
      agent: idumb-low-validator
      checks:
        - coverage_all_domains
        - actionable_insights
        - source_attribution
        
    7_store_research:
      action: "Save research document"
      path: ".idumb/governance/research/{timestamp}-{topic}.md"
      
    8_update_state:
      action: "Record research completion"
      tool: idumb-state:history
      action_name: research_completed
```

## Output Artifact

```yaml
artifact:
  name: "{timestamp}-{topic}.md"
  path: ".idumb/governance/research/"
  sections:
    - executive_summary: "2-3 paragraph overview"
    - technical_findings: "Options, recommendations, risks"
    - market_findings: "Trends, opportunities, threats"
    - user_findings: "Personas, needs, priorities"
    - competitor_findings: "Landscape, gaps, differentiation"
    - synthesis: "Key insights, action items, open questions"
    - sources: "Attribution list"
```

## Exit Conditions

```yaml
exit_conditions:
  success:
    - artifact_created: true
    - synthesis_validated: true
    - state_updated: true
  failure:
    - timeout: "Report partial results"
    - no_sources: "Warn and suggest manual research"
```

## Chain Rules

```yaml
chains_to:
  on_success:
    command: "/idumb:roadmap --from-research"
    message: "Research complete. Create roadmap?"
    auto: false
```

## Integration Points

```yaml
integration:
  gsd_equivalent: null  # iDumb-native command
  reads_from:
    - ".idumb/brain/state.json"
    - ".planning/PROJECT.md"
  writes_to:
    - ".idumb/governance/research/"
    - ".idumb/brain/state.json"
```

---
*Workflow: research v0.1.0*
```

**Acceptance Criteria:**
- [ ] File created at correct path
- [ ] Matches structure of existing workflows
- [ ] Entry conditions align with command requirements
</task>

<task id="A3-T3" priority="P1">
### Create roadmap.md Workflow

**File:** `template/workflows/roadmap.md` (NEW)  
**Action:** Create workflow file matching command structure

**Content:**
```markdown
---
name: roadmap
description: "Creates project roadmap with phases, milestones, and dependencies"
type: workflow
version: 0.1.0
last_updated: 2026-02-03
---

# Roadmap Workflow

Generates a structured project roadmap from research and requirements.

## Entry Conditions

```yaml
entry_conditions:
  must_have:
    - exists: ".idumb/brain/state.json"
    - state: "initialized = true"
  should_have:
    - exists: ".idumb/governance/research/"
    - exists: ".planning/PROJECT.md"
  blocked_when:
    - condition: "!exists('.idumb/brain/state.json')"
      redirect: "/idumb:init"
      message: "iDumb not initialized"
```

## Workflow Steps

```yaml
workflow:
  name: roadmap
  interactive: true  # User confirms phases
  
  steps:
    1_validate_prerequisites:
      action: "Check for research or requirements"
      sources:
        - ".idumb/governance/research/"
        - ".planning/PROJECT.md"
        - ".planning/REQUIREMENTS.md"
        - "User input"
        
    2_load_context:
      action: "Gather project context"
      tools:
        - idumb-context:summary
        - idumb-config:read
        
    3_delegate_roadmapper:
      action: "Delegate to roadmapper agent"
      agent: idumb-roadmapper
      inputs:
        - research_findings
        - project_context
        - constraints
        
    4_generate_phases:
      action: "Create phase structure"
      for_each: major_deliverable
      create:
        - phase_definition
        - objectives
        - milestones
        - dependencies
        
    5_validate_roadmap:
      action: "Check roadmap validity"
      agent: idumb-low-validator
      checks:
        - logical_flow
        - dependency_cycles
        - realistic_scope
        
    6_store_roadmap:
      action: "Save roadmap"
      paths:
        - ".idumb/governance/roadmap.md"
        - ".planning/ROADMAP.md (if GSD)"
        
    7_update_state:
      action: "Record roadmap creation"
      tool: idumb-state:write
      phase: "roadmap_created"
```

## Output Artifact

```yaml
artifact:
  name: "ROADMAP.md"
  paths:
    - ".planning/ROADMAP.md"
    - ".idumb/governance/roadmap.md"
  sections:
    - overview: "Project summary and goals"
    - phases:
        for_each:
          - name: "Phase name"
          - objective: "Clear objective"
          - milestones: "List of milestones"
          - deliverables: "Expected outputs"
          - dependencies: "Phase dependencies"
    - timeline: "Estimated schedule"
    - risks: "Risk mitigation"
```

## Exit Conditions

```yaml
exit_conditions:
  success:
    - artifact_created: ".planning/ROADMAP.md"
    - no_cycles: true
    - state_updated: true
  failure:
    - dependency_cycle: "Report cycle and ask for resolution"
    - no_input: "Request research or requirements"
```

## Chain Rules

```yaml
chains_to:
  on_success:
    command: "/idumb:discuss-phase 1"
    message: "Roadmap created. Discuss first phase?"
    auto: false
    
  on_failure:
    redirect:
      no_research: "/idumb:research"
      no_project: "/idumb:new-project"
```

## Integration Points

```yaml
integration:
  gsd_equivalent: "/gsd:roadmap"
  reads_from:
    - ".idumb/governance/research/"
    - ".planning/PROJECT.md"
    - ".planning/REQUIREMENTS.md"
  writes_to:
    - ".planning/ROADMAP.md"
    - ".idumb/governance/roadmap.md"
    - ".idumb/brain/state.json"
  never_modifies:
    - ".planning/PROJECT.md"
```

---
*Workflow: roadmap v0.1.0*
```

**Acceptance Criteria:**
- [ ] File created at correct path
- [ ] Matches structure of existing workflows
- [ ] GSD integration points defined
</task>

---

## Dependency Graph

```
A2-T1 ─┬─ (parallel, no dependencies)
A2-T2 ─┤
A2-T3 ─┤
A2-T4 ─┤
A2-T5 ─┤
A2-T6 ─┤
A2-T7 ─┤
A2-T8 ─┘

A3-T1 ─┬─ (parallel, no dependencies)
A3-T2 ─┤
A3-T3 ─┘
```

## Execution Strategy

1. **Batch 1 (Parallel):** Execute all A2-T* tasks - add frontmatter to 8 commands
2. **Batch 2 (Parallel):** Execute all A3-T* tasks - create 3 missing files

## Validation Checkpoints

- [ ] **Post-Batch-1:** All 8 command files have valid YAML frontmatter
- [ ] **Post-Batch-2:** All 3 new files created and valid
- [ ] **Final:** `idumb-low-validator` confirms no broken references

## Risk Mitigation

| Risk | Mitigation |
|------|------------|
| Frontmatter breaks existing parsing | Test each file after modification |
| New command missing required fields | Follow existing command templates |
| Workflow doesn't match command | Cross-reference command during creation |

---

*Plan: 01-02 Command/Workflow Fixes*  
*Phase: 01-contracts-first-governance-core*  
*Created: 2026-02-03*
