# 01-01 Plan: Agent Structure Fixes

**Phase:** 01-contracts-first-governance-core
**Plan ID:** P1-01
**Created:** 2026-02-03
**Status:** Ready for execution

---

## Overview

**Objective:** Fix broken agent structure by adding OpenCode frontmatter to 6 existing agents and creating 4 missing agents.

**Estimated Duration:** 2 hours
**Task Count:** 10 tasks
**Parallel Tracks:** 2 (frontmatter + creation)

**Source:** `.planning/phases/01-contracts-first-governance-core/01-CONTEXT.md` Part A

---

## Tasks

<task id="P1-01-T1">
### Task 1: Add Frontmatter to idumb-planner.md

**Work Package:** WP1-Frontmatter
**Description:** Add OpenCode-compatible YAML frontmatter to `template/agents/idumb-planner.md`. The frontmatter must be prepended BEFORE the existing `# @idumb-planner` heading.

**File:** `template/agents/idumb-planner.md`

**Frontmatter to prepend:**
```yaml
---
description: "Creates detailed implementation plans for project phases with estimates, dependencies, and resource assignments"
mode: subagent
hidden: true
temperature: 0.2
permission:
  task:
    "*": deny
  bash:
    "*": deny
  edit: deny
  write: deny
tools:
  task: false
  idumb-state: true
  idumb-context: true
---
```

**Acceptance Criteria:**
- [ ] Frontmatter is YAML-valid
- [ ] Placed before `# @idumb-planner` heading
- [ ] File parses correctly (no syntax errors)

**Estimate:** 5 minutes
**Agent Type:** builder
**Dependencies:** None
**Risk Level:** Low
</task>

<task id="P1-01-T2">
### Task 2: Add Frontmatter to idumb-plan-checker.md

**Work Package:** WP1-Frontmatter
**Description:** Add OpenCode-compatible YAML frontmatter to `template/agents/idumb-plan-checker.md`.

**File:** `template/agents/idumb-plan-checker.md`

**Frontmatter to prepend:**
```yaml
---
description: "Validates phase plans for completeness, feasibility, and correctness before execution"
mode: subagent
hidden: true
temperature: 0.2
permission:
  task:
    "*": deny
  bash:
    "*": deny
  edit: deny
  write: deny
tools:
  task: false
  idumb-state: true
  idumb-context: true
---
```

**Acceptance Criteria:**
- [ ] Frontmatter is YAML-valid
- [ ] Placed before `# @idumb-plan-checker` heading
- [ ] File parses correctly

**Estimate:** 5 minutes
**Agent Type:** builder
**Dependencies:** None
**Risk Level:** Low
</task>

<task id="P1-01-T3">
### Task 3: Add Frontmatter to idumb-roadmapper.md

**Work Package:** WP1-Frontmatter
**Description:** Add OpenCode-compatible YAML frontmatter to `template/agents/idumb-roadmapper.md`.

**File:** `template/agents/idumb-roadmapper.md`

**Frontmatter to prepend:**
```yaml
---
description: "Creates comprehensive project roadmaps with phases, milestones, dependencies, and timelines"
mode: subagent
hidden: true
temperature: 0.2
permission:
  task:
    "*": deny
  bash:
    "*": deny
  edit: deny
  write: deny
tools:
  task: false
  idumb-state: true
  idumb-context: true
---
```

**Acceptance Criteria:**
- [ ] Frontmatter is YAML-valid
- [ ] Placed before `# @idumb-roadmapper` heading
- [ ] File parses correctly

**Estimate:** 5 minutes
**Agent Type:** builder
**Dependencies:** None
**Risk Level:** Low
</task>

<task id="P1-01-T4">
### Task 4: Add Frontmatter to idumb-phase-researcher.md

**Work Package:** WP1-Frontmatter
**Description:** Add OpenCode-compatible YAML frontmatter to `template/agents/idumb-phase-researcher.md`.

**File:** `template/agents/idumb-phase-researcher.md`

**Frontmatter to prepend:**
```yaml
---
description: "Conducts phase-specific research on implementation approaches, best practices, and potential pitfalls"
mode: subagent
hidden: true
temperature: 0.2
permission:
  task:
    "*": deny
  bash:
    "*": deny
  edit: deny
  write: deny
tools:
  task: false
  idumb-state: true
  idumb-context: true
---
```

**Acceptance Criteria:**
- [ ] Frontmatter is YAML-valid
- [ ] Placed before `# @idumb-phase-researcher` heading
- [ ] File parses correctly

**Estimate:** 5 minutes
**Agent Type:** builder
**Dependencies:** None
**Risk Level:** Low
</task>

<task id="P1-01-T5">
### Task 5: Add Frontmatter to idumb-project-researcher.md

**Work Package:** WP1-Frontmatter
**Description:** Add OpenCode-compatible YAML frontmatter to `template/agents/idumb-project-researcher.md`.

**File:** `template/agents/idumb-project-researcher.md`

**Frontmatter to prepend:**
```yaml
---
description: "Parallel research agent for domain-specific investigation (tech, market, user, competitor)"
mode: subagent
hidden: true
temperature: 0.2
permission:
  task:
    "*": deny
  bash:
    "*": deny
  edit: deny
  write: deny
tools:
  task: false
  idumb-state: true
  idumb-context: true
---
```

**Acceptance Criteria:**
- [ ] Frontmatter is YAML-valid
- [ ] Placed before `# @idumb-project-researcher` heading
- [ ] File parses correctly

**Estimate:** 5 minutes
**Agent Type:** builder
**Dependencies:** None
**Risk Level:** Low
</task>

<task id="P1-01-T6">
### Task 6: Add Frontmatter to idumb-research-synthesizer.md

**Work Package:** WP1-Frontmatter
**Description:** Add OpenCode-compatible YAML frontmatter to `template/agents/idumb-research-synthesizer.md`.

**File:** `template/agents/idumb-research-synthesizer.md`

**Frontmatter to prepend:**
```yaml
---
description: "Synthesizes parallel research outputs into unified, actionable research documents"
mode: subagent
hidden: true
temperature: 0.2
permission:
  task:
    "*": deny
  bash:
    "*": deny
  edit: deny
  write: deny
tools:
  task: false
  idumb-state: true
  idumb-context: true
---
```

**Acceptance Criteria:**
- [ ] Frontmatter is YAML-valid
- [ ] Placed before `# @idumb-research-synthesizer` heading
- [ ] File parses correctly

**Estimate:** 5 minutes
**Agent Type:** builder
**Dependencies:** None
**Risk Level:** Low
</task>

<task id="P1-01-T7">
### Task 7: Create idumb-executor.md

**Work Package:** WP2-NewAgents
**Description:** Create new agent file `template/agents/idumb-executor.md` for phase execution coordination.

**File:** `template/agents/idumb-executor.md`

**Full content:**
```markdown
---
description: "Executes phase plans by coordinating task delegation and tracking progress"
mode: subagent
hidden: true
temperature: 0.2
permission:
  task:
    "*": deny
  bash:
    "*": deny
  edit: deny
  write: deny
tools:
  task: false
  idumb-state: true
  idumb-context: true
---

# @idumb-executor

Executes phase plans by coordinating task execution and tracking progress.

## Purpose

Takes validated phase plans and orchestrates their execution by delegating tasks to appropriate agents while tracking completion status.

## Activation

` ` `yaml
trigger: phase_execution_started
inputs:
  - validated_plan
  - resource_availability
  - constraints
` ` `

## Responsibilities

1. **Task Delegation**: Assign tasks to appropriate agents
2. **Progress Tracking**: Monitor task completion
3. **Dependency Management**: Ensure proper task ordering
4. **Status Reporting**: Report execution progress
5. **Blocker Resolution**: Escalate blocking issues

## Execution Process

` ` `yaml
execution_workflow:
  1_load_plan:
    action: Load validated phase plan
    verify:
      - plan_exists
      - plan_validated
      - dependencies_clear
      
  2_prioritize_tasks:
    action: Order tasks by dependency/priority
    output: execution_queue
    
  3_execute_task:
    action: For each task in queue
    steps:
      - check_dependencies_complete
      - delegate_to_agent
      - await_completion
      - verify_result
      - update_status
      
  4_handle_blockers:
    action: On task failure
    options:
      - retry_task
      - escalate_to_governance
      - skip_if_optional
      
  5_report_progress:
    action: Continuous status updates
    format: progress_report
` ` `

## Output Format

` ` `yaml
execution_status:
  phase: "[phase name]"
  plan_id: "[plan ID]"
  tasks_total: [count]
  tasks_complete: [count]
  tasks_in_progress: [count]
  tasks_blocked: [count]
  current_task: "[task ID]"
  blockers: [list]
  eta: "[time estimate]"
` ` `

## Integration

Consumes from:
- @idumb-planner (validated plans)
- @idumb-high-governance

Delegates to:
- @idumb-builder (implementation)
- @idumb-verifier (validation)

Reports to:
- @idumb-high-governance

## Metadata

` ` `yaml
agent_type: executor
output_format: yaml
time_limit: phase_duration
version: 0.1.0
` ` `
```

**Acceptance Criteria:**
- [ ] File created at correct path
- [ ] Frontmatter is YAML-valid
- [ ] Content follows agent template structure
- [ ] Integration section accurate

**Estimate:** 15 minutes
**Agent Type:** builder
**Dependencies:** None
**Risk Level:** Low
</task>

<task id="P1-01-T8">
### Task 8: Create idumb-verifier.md

**Work Package:** WP2-NewAgents
**Description:** Create new agent file `template/agents/idumb-verifier.md` for work verification.

**File:** `template/agents/idumb-verifier.md`

**Full content:**
```markdown
---
description: "Verifies completed work against acceptance criteria and produces evidence reports"
mode: subagent
hidden: true
temperature: 0.2
permission:
  task:
    "*": deny
  bash:
    "pnpm test*": allow
    "npm test*": allow
    "git diff*": allow
    "git log*": allow
    "*": deny
  edit: deny
  write: deny
tools:
  task: false
  idumb-state: true
  idumb-context: true
  idumb-validate: true
---

# @idumb-verifier

Verifies completed work against acceptance criteria and produces evidence.

## Purpose

Validates that completed tasks meet their acceptance criteria and produces structured evidence for governance records.

## Activation

` ` `yaml
trigger: task_completion_claimed
inputs:
  - task_definition
  - acceptance_criteria
  - work_artifacts
` ` `

## Responsibilities

1. **Criteria Verification**: Check each acceptance criterion
2. **Evidence Collection**: Gather proof of completion
3. **Quality Assessment**: Evaluate work quality
4. **Issue Identification**: Flag problems or gaps
5. **Report Generation**: Produce verification report

## Verification Process

` ` `yaml
verification_workflow:
  1_load_criteria:
    action: Load acceptance criteria
    source: task_definition
    
  2_collect_artifacts:
    action: Gather work outputs
    sources:
      - file_changes
      - test_results
      - command_outputs
      
  3_verify_each_criterion:
    action: For each criterion
    steps:
      - identify_evidence_needed
      - collect_evidence
      - evaluate_pass_fail
      - document_result
      
  4_assess_quality:
    action: Overall quality check
    dimensions:
      - correctness
      - completeness
      - code_quality
      - documentation
      
  5_generate_report:
    action: Create verification report
    format: structured_evidence
` ` `

## Evidence Types

` ` `yaml
evidence_types:
  file_evidence:
    - file_exists
    - content_matches
    - structure_correct
    
  test_evidence:
    - tests_pass
    - coverage_threshold
    - no_regressions
    
  command_evidence:
    - command_output
    - exit_code
    - expected_result
    
  review_evidence:
    - code_review_passed
    - documentation_complete
    - standards_met
` ` `

## Output Format

` ` `yaml
verification_report:
  task_id: "[task ID]"
  status: pass | fail | partial
  criteria_results:
    - criterion: "[description]"
      status: pass | fail
      evidence: "[proof]"
  quality_score: [1-10]
  issues_found: [list]
  recommendations: [list]
  timestamp: "[ISO]"
  verifier: "@idumb-verifier"
` ` `

## Integration

Consumes from:
- @idumb-executor (completed work)
- @idumb-builder (artifacts)

Delivers to:
- @idumb-high-governance (evidence)
- Governance records

Reports to:
- @idumb-high-governance

## Metadata

` ` `yaml
agent_type: verifier
output_format: yaml
time_limit: 10m
version: 0.1.0
` ` `
```

**Acceptance Criteria:**
- [ ] File created at correct path
- [ ] Frontmatter is YAML-valid
- [ ] Has appropriate bash permissions for testing
- [ ] Content follows agent template structure

**Estimate:** 15 minutes
**Agent Type:** builder
**Dependencies:** None
**Risk Level:** Low
</task>

<task id="P1-01-T9">
### Task 9: Create idumb-debugger.md

**Work Package:** WP2-NewAgents
**Description:** Create new agent file `template/agents/idumb-debugger.md` for issue diagnosis.

**File:** `template/agents/idumb-debugger.md`

**Full content:**
```markdown
---
description: "Diagnoses issues, identifies root causes, and proposes fixes for failed tasks or system problems"
mode: subagent
hidden: true
temperature: 0.3
permission:
  task:
    "*": deny
  bash:
    "git diff*": allow
    "git log*": allow
    "git show*": allow
    "pnpm test*": allow
    "npm test*": allow
    "*": deny
  edit: deny
  write: deny
tools:
  task: false
  idumb-state: true
  idumb-context: true
  idumb-validate: true
---

# @idumb-debugger

Diagnoses issues and identifies root causes for failed tasks.

## Purpose

When tasks fail or issues arise, investigates the problem, identifies root causes, and proposes actionable fixes.

## Activation

` ` `yaml
trigger: task_failed | issue_reported
inputs:
  - failure_context
  - error_messages
  - relevant_artifacts
  - task_history
` ` `

## Responsibilities

1. **Issue Triage**: Classify and prioritize issues
2. **Root Cause Analysis**: Find underlying causes
3. **Evidence Gathering**: Collect diagnostic information
4. **Fix Proposals**: Suggest remediation steps
5. **Prevention Recommendations**: Prevent recurrence

## Debugging Process

` ` `yaml
debugging_workflow:
  1_understand_failure:
    action: Gather failure context
    collect:
      - error_messages
      - stack_traces
      - task_context
      - recent_changes
      
  2_reproduce_issue:
    action: Attempt to reproduce
    methods:
      - run_failing_test
      - execute_failing_command
      - review_state_changes
      
  3_isolate_cause:
    action: Narrow down root cause
    techniques:
      - binary_search
      - dependency_analysis
      - state_comparison
      - timeline_reconstruction
      
  4_propose_fixes:
    action: Generate fix options
    for_each: root_cause
    provide:
      - fix_description
      - implementation_steps
      - risk_assessment
      - verification_method
      
  5_recommend_prevention:
    action: Prevent future occurrences
    consider:
      - test_coverage
      - validation_checks
      - process_improvements
` ` `

## Issue Categories

` ` `yaml
issue_categories:
  code_issues:
    - syntax_errors
    - logic_errors
    - type_errors
    - runtime_exceptions
    
  integration_issues:
    - api_mismatches
    - dependency_conflicts
    - configuration_errors
    - environment_issues
    
  process_issues:
    - missing_dependencies
    - incomplete_prerequisites
    - incorrect_ordering
    - resource_unavailability
    
  data_issues:
    - invalid_input
    - corrupted_state
    - missing_data
    - format_mismatches
` ` `

## Output Format

` ` `yaml
debug_report:
  issue_id: "[generated ID]"
  issue_summary: "[brief description]"
  severity: critical | high | medium | low
  root_cause:
    category: "[category]"
    description: "[detailed explanation]"
    evidence: "[supporting evidence]"
  proposed_fixes:
    - fix_id: "F1"
      description: "[what to do]"
      complexity: low | medium | high
      risk: low | medium | high
      steps:
        - "[step 1]"
        - "[step 2]"
      verification: "[how to verify]"
  prevention:
    - "[recommendation 1]"
    - "[recommendation 2]"
  timestamp: "[ISO]"
  debugger: "@idumb-debugger"
` ` `

## Integration

Consumes from:
- @idumb-verifier (failure reports)
- @idumb-executor (blocked tasks)

Delivers to:
- @idumb-high-governance (diagnosis)
- @idumb-builder (fix implementation)

Reports to:
- @idumb-high-governance

## Metadata

` ` `yaml
agent_type: debugger
output_format: yaml
time_limit: 15m
version: 0.1.0
` ` `
```

**Acceptance Criteria:**
- [ ] File created at correct path
- [ ] Frontmatter is YAML-valid
- [ ] Temperature slightly higher (0.3) for creative problem-solving
- [ ] Content follows agent template structure

**Estimate:** 15 minutes
**Agent Type:** builder
**Dependencies:** None
**Risk Level:** Low
</task>

<task id="P1-01-T10">
### Task 10: Create idumb-integration-checker.md

**Work Package:** WP2-NewAgents
**Description:** Create new agent file `template/agents/idumb-integration-checker.md` for integration validation.

**File:** `template/agents/idumb-integration-checker.md`

**Full content:**
```markdown
---
description: "Validates integration points between components, agents, and external systems"
mode: subagent
hidden: true
temperature: 0.2
permission:
  task:
    "*": deny
  bash:
    "pnpm test*": allow
    "npm test*": allow
    "git diff*": allow
    "*": deny
  edit: deny
  write: deny
tools:
  task: false
  idumb-state: true
  idumb-context: true
  idumb-validate: true
  idumb-manifest: true
---

# @idumb-integration-checker

Validates integration points between components and systems.

## Purpose

Ensures that different parts of the system work together correctly by validating interfaces, data flows, and integration contracts.

## Activation

` ` `yaml
trigger: integration_check_requested | phase_boundary
inputs:
  - components_to_check
  - integration_contracts
  - expected_behaviors
` ` `

## Responsibilities

1. **Interface Validation**: Check API contracts
2. **Data Flow Verification**: Validate data passing
3. **Agent Communication**: Verify agent interactions
4. **State Consistency**: Check cross-component state
5. **External Integration**: Validate external dependencies

## Checking Process

` ` `yaml
integration_workflow:
  1_identify_integration_points:
    action: Map all integration points
    types:
      - agent_to_agent
      - tool_to_tool
      - file_to_file
      - external_apis
      
  2_load_contracts:
    action: Get expected interfaces
    sources:
      - agent_definitions
      - tool_schemas
      - api_specifications
      
  3_validate_each_point:
    action: For each integration point
    checks:
      - interface_compatibility
      - data_format_match
      - error_handling
      - timeout_handling
      
  4_test_flows:
    action: Execute integration tests
    if_available:
      - run_integration_tests
      - simulate_data_flows
      - verify_outputs
      
  5_generate_report:
    action: Create integration report
    include:
      - all_checks_performed
      - pass_fail_status
      - issues_found
      - recommendations
` ` `

## Integration Point Types

` ` `yaml
integration_types:
  agent_delegation:
    check:
      - input_format_match
      - output_format_match
      - permission_compatibility
      - error_propagation
      
  tool_invocation:
    check:
      - parameter_schemas
      - return_types
      - error_handling
      - state_side_effects
      
  file_dependencies:
    check:
      - file_exists
      - format_valid
      - content_compatible
      - timestamps_reasonable
      
  state_synchronization:
    check:
      - state_consistency
      - update_propagation
      - conflict_detection
      - recovery_capability
` ` `

## Output Format

` ` `yaml
integration_report:
  scope: "[what was checked]"
  timestamp: "[ISO]"
  summary:
    total_points: [count]
    passed: [count]
    failed: [count]
    warnings: [count]
  results:
    - point: "[integration point name]"
      type: "[type]"
      status: pass | fail | warning
      details: "[explanation]"
      evidence: "[proof]"
  issues:
    - issue: "[description]"
      severity: critical | high | medium | low
      affected_components: [list]
      recommendation: "[fix suggestion]"
  overall_status: healthy | degraded | broken
  checker: "@idumb-integration-checker"
` ` `

## Integration

Consumes from:
- @idumb-manifest (component registry)
- Agent definitions
- Tool schemas

Delivers to:
- @idumb-high-governance (integration status)
- Phase verification

Reports to:
- @idumb-high-governance

## Metadata

` ` `yaml
agent_type: checker
output_format: yaml
time_limit: 10m
version: 0.1.0
` ` `
```

**Acceptance Criteria:**
- [ ] File created at correct path
- [ ] Frontmatter is YAML-valid
- [ ] Has access to idumb-manifest tool
- [ ] Content follows agent template structure

**Estimate:** 15 minutes
**Agent Type:** builder
**Dependencies:** None
**Risk Level:** Low
</task>

---

## Work Packages

### WP1: Frontmatter Updates
**Objective:** Add OpenCode frontmatter to 6 existing agents
**Tasks:** P1-01-T1 through P1-01-T6
**Duration:** 30 minutes
**Dependencies:** None

### WP2: New Agent Creation
**Objective:** Create 4 missing agents
**Tasks:** P1-01-T7 through P1-01-T10
**Duration:** 1 hour
**Dependencies:** None (can run parallel to WP1)

---

## Schedule

### Timeline
```
Hour 1:  [T1-T6] Frontmatter updates (parallel possible)
Hour 2:  [T7-T10] New agent creation (parallel possible)
```

### Task Schedule
| Task | Start | Duration | Assignee | Dependencies |
|------|-------|----------|----------|--------------|
| T1-T6 | Hour 1 | 30min | builder | - |
| T7-T10 | Hour 1-2 | 60min | builder | - |

---

## Dependency Graph

```
[T1] ─┐
[T2] ─┤
[T3] ─┼─→ [Validation Checkpoint] ─→ [Complete]
[T4] ─┤
[T5] ─┤
[T6] ─┘

[T7] ─┐
[T8] ─┼─→ [Validation Checkpoint] ─→ [Complete]
[T9] ─┤
[T10]─┘
```

---

## Checkpoints

### Entry Checkpoint
**Criteria:**
- [x] 01-CONTEXT.md read and understood
- [x] All 6 target agent files exist
- [x] Frontmatter template available

### Progress Checkpoint (After WP1)
**Criteria:**
- [ ] All 6 agents have valid frontmatter
- [ ] No syntax errors in modified files
- [ ] Git status shows changes

### Exit Checkpoint
**Criteria:**
- [ ] All 10 tasks complete
- [ ] All files parse correctly
- [ ] State.json updated
- [ ] Changes committed

---

## Risk Management

| Task | Risk | Likelihood | Impact | Mitigation |
|------|------|------------|--------|------------|
| T1-T6 | YAML syntax error | Low | Medium | Validate each frontmatter block |
| T7-T10 | Missing integration points | Medium | Low | Review existing agents for patterns |

---

## Validation

Post-execution, delegate to @idumb-low-validator:
1. Check each file has valid YAML frontmatter
2. Verify all 10 files exist
3. Confirm no duplicate agent names
4. Check integration references are valid

---

*Plan created: 2026-02-03*
*Author: @idumb-high-governance*
*Status: Ready for execution*
